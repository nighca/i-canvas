define("i-canvas/0.0.1/index",["i-canvas/0.0.1/core","i-canvas/0.0.1/plugin/movable","i-canvas/0.0.1/lib/lib","i-canvas/0.0.1/lib/class","i-canvas/0.0.1/lib/util"],function(t,e,i){var n=t("i-canvas/0.0.1/core");t("i-canvas/0.0.1/plugin/movable"),i.exports=n}),define("i-canvas/0.0.1/core",["i-canvas/0.0.1/lib/lib","i-canvas/0.0.1/lib/class","i-canvas/0.0.1/lib/util"],function(t,e,i){"use strict";t("i-canvas/0.0.1/lib/lib");var n=t("i-canvas/0.0.1/lib/class"),r=t("i-canvas/0.0.1/lib/util"),o=n.extend("DomEvent",{prevented:!1,stopped:!1,init:function(t){$.extend(this,t,!0)},preventDefault:function(){this.prevented=!0},stopPropagation:function(){this.stopped=!0}}),s=r.EventEmitter.extend("Element",{attr:{top:0,left:0,width:0,height:0,background:null,position:"relative","z-index":null,visible:!0,"border-width":0,border:null},init:function(t,e){this.document=t,this.attr=$.extend(this.attr,e),this.children=[],this.__cache__={}},getAttribute:function(t){return this.attr[t]},setAttribute:function(t,e){if("[object String]"===$.type(t))this.attr[t]=e,this.document.fireDomEvent("attr-modify",{target:this,attr:t,val:e});else{var i=this;$.forEach(t,function(t,e){i.setAttribute(e,t)})}return this},show:function(){this.setAttribute("visible",!0)},hide:function(){this.setAttribute("visible",!1)},getPos:function(){var t=this.attr;switch(t.position){case"absolute":return{x:t.left,y:t.top};case"relative":var e=this.parent?this.parent.getPos():{x:0,y:0};return{x:e.x+t.left,y:e.y+t.top};default:return{x:0,y:0}}},getZIndex:function(){return null===this.attr["z-index"]?this.parent?this.parent.getZIndex():0:this.attr["z-index"]},draw:function(){return this},walk:function(t,e){e?(this.children.forEach(function(e){e.walk(t,!0)}),t(this)):(t(this),this.children.forEach(function(e){e.walk(t)}))},appendChild:function(t){return t&&t instanceof s&&this.children.indexOf(t)<0&&(t.parent&&t.parent.removeChild(t),this.children.push(t),t.parent=this,this.document.fireDomEvent("subtree-modify",{target:this,add:t})),this},insertBefore:function(t,e){var i;return t&&t instanceof s&&this.children.indexOf(t)<0&&e&&e instanceof s&&(i=this.children.indexOf(e))>=0&&(t.parent&&t.parent.removeChild(t),this.children.splice(i-1,0,t),t.parent=this,this.document.fireDomEvent("subtree-modify",{target:this,add:t})),this},removeChild:function(t){var e=-1;if(t&&t instanceof s)e=this.children.indexOf(t);else{if("number"!=typeof t)return this;e=t,t=this.children[e]}return e>=0&&(this.children.splice(e,1),t.parent=null,this.document.fireDomEvent("subtree-modify",{target:this,remove:t})),this},containsPoint:function(){return!1},contains:function(t){for(;t;){if(t===this)return!0;t=t.parent}return!1}});s.types={};var a=r.EventEmitter.extend("DomManager",{init:function(t){this.dom=t.dom,this.width=t.width,this.height=t.height,this.clientWidth=this.dom.clientWidth,this.clientHeight=this.dom.clientHeight,this.scaleWidth=this.width/this.clientWidth,this.scaleHeight=this.height/this.clientHeight,this.body=this.createElement("rectangle",{width:this.width,height:this.height,background:"red"}),this.delegateEvents()},createElement:function(t,e){return s.types[t]?new s.types[t](this,e):null},fireDomEvent:function(t,e){var i=new o($.extend(e,{type:t},!0)),n=i.target;if(n.fire(t,i),["attr-modify","mouseenter","mouseleave"].indexOf(t)<0)for(;n.parent&&!i.stopped;)(n=n.parent).fire(t,i);this.fire("dom-event",{domEvent:i})},getRenderQueue:function(){var t=[];this.body.walk(function(e){e.__cache__.zIndex=null,t.push(e)});var e=function(t){return null!==t.__cache__.zIndex?t.__cache__.zIndex:t.__cache__.zIndex=t.getZIndex()};return t=r.stableSort(t,function(t,i){return e(t)>e(i)})},delegateEvents:function(){var t=this,e=t.dom;["click","drag","drop","mousedown","mousemove","mouseup"].forEach(function(i){e.on(i,function(e){for(var n,r=e.offsetX*t.scaleWidth,o=e.offsetY*t.scaleHeight,s=e,a=t.getRenderQueue(),c=a.length-1;c>=0;c--)if(a[c].containsPoint(r,o)){n=a[c];break}n&&t.fireDomEvent(i,{x:r,y:o,origin:s,target:n})})});var i={};["mouseenter","mousemove","mouseleave"].forEach(function(n){e.on(n,function(e){for(var n,r=e.offsetX*t.scaleWidth,o=e.offsetY*t.scaleHeight,s=e,a=t.getRenderQueue(),c=a.length-1;c>=0;c--)if(a[c].containsPoint(r,o)){n=a[c];break}if(n!==i.target){for(var u=i.target;u&&!u.contains(n);)u=u.parent;for(var h=i.target;h!==u;)t.fireDomEvent("mouseleave",{x:r,y:o,origin:s,target:h}),h=h.parent;for(h=n;h!==u;)t.fireDomEvent("mouseenter",{x:r,y:o,origin:s,target:h}),h=h.parent}i={e:e,target:n}})})}}),c=r.EventEmitter.extend("Canvas",{init:function(t,e){var i=this;i.dom=t,i.ctx=i.dom.getContext(e||"2d"),i.width=t.width,i.height=t.height,i.document=new a({dom:t,width:i.width,height:i.height});var n;i.document.on("dom-event",function(t){["attr-modify","subtree-modify"].indexOf(t.domEvent.type)>=0&&(clearTimeout(n),n=setTimeout(function(){i.draw()},0))}),i.draw()},draw:function(){var t=this,e=t.ctx;e.clearRect(0,0,this.width,this.height),this.document.getRenderQueue().forEach(function(e){e.getAttribute("visible")&&e.draw(t)})},drawRectangle:function(t,e,i,n,r){var o=this.ctx,s=o.fillStyle;o.fillStyle=r,o.fillRect(t,e,i,n),o.fillStyle=s},drawCircle:function(t,e,i,n){var r=this.ctx,o=r.fillStyle;r.fillStyle=n,r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!0),r.closePath(),r.fill(),r.fillStyle=o}}),u=function(t,e,i){i=i?s.types[i]:s,e.attr=$.extend(e.attr,i.prototype.attr,!0),s.types[t]=i.extend(t[0].toUpperCase()+t.slice(1),e)};u("rectangle",{draw:function(t){var e=this.getPos(),i=this.attr;if(i.border){var n=i["border-width"];t.drawRectangle(e.x-n,e.y-n,i.width+2*n,i.height+2*n,i.border)}return i.background&&t.drawRectangle(e.x,e.y,i.width,i.height,i.background),this},containsPoint:function(t,e){var i=this.getPos(),n=this.attr,r=n.border?n["border-width"]:0;return t>=i.x-r&&t<=i.x+n.width+r&&e>=i.y-r&&e<=i.y+n.height+r}}),u("circle",{attr:{radius:0},draw:function(t){var e=this.getPos(),i=this.attr;if(i.border){var n=i["border-width"];t.drawCircle(e.x,e.y,i.radius+n,i.border)}return i.background&&t.drawCircle(e.x,e.y,i.radius,i.background),this},containsPoint:function(t,e){var i=this.getPos(),n=this.attr,r=n.border?n["border-width"]:0,o=Math.pow(t-i.x,2)+Math.pow(e-i.y,2),s=Math.pow(n.radius+r,2);return s>=o}});var h=function(t,e){return s.prototype[t]=e};$.extend(c,{extendElementType:u,extendElementMethod:h},!0),i.exports=c}),define("i-canvas/0.0.1/plugin/movable",["i-canvas/0.0.1/core","i-canvas/0.0.1/lib/lib","i-canvas/0.0.1/lib/class","i-canvas/0.0.1/lib/util"],function(t){var e=t("i-canvas/0.0.1/core"),i=function(){var t=0,e=0,i=$(window),n=this,r=function(i){n.setAttribute({left:i.offsetX-t,top:i.offsetY-e})},o=function(){i.un("mousemove",r),i.un("mouseup",o)};n.on("mousedown",function(s){s.stopPropagation(),t=s.x-n.getAttribute("left"),e=s.y-n.getAttribute("top"),i.on("mousemove",r),i.on("mouseup",o)})};e.extendElementMethod("movable",i)}),define("i-canvas/0.0.1/lib/lib",[],function(){"use strict";var t=Object.prototype.toString.call.bind(Object.prototype.toString),e=function(e,i){if("[object Array]"!==t(e)){for(var n in e)if(e.hasOwnProperty(n)&&i.call(this,e[n],n)===!1)return}else for(var r=0,o=e.length;o>r&&i.call(this,e[r],r)!==!1;r++);},i=function(t){if(!t)return t;var i=new t.constructor;return e(t,function(t,e){i[e]=t}),i},n=function(t,n,r){return t=(r?t:i(t))||{},e(n,function(e,i){t[i]=e}),t},r={on:HTMLElement.prototype.addEventListener,un:HTMLElement.prototype.removeEventListener,css:function(i,n){var r=this;return"[object String]"===t(i)?this.style.setProperty(i,n):e(i,function(t,e){r.css(e,t)})},show:function(){this.css("display","")},hide:function(){this.css("display","none")},find:function(t){return s(t,this)},parent:function(){return o(this.parentNode)}},o=function(t){return t?n(t,r,!0):t},s=function(e,i){return o("[object String]"===t(e)?(i||document).querySelector(e):e)},a=function(e,i){return Array.prototype.slice.call("[object String]"===t(e)?(i||document).querySelectorAll(e):e).map(o)};n(s,{type:t,forEach:e,clone:i,extend:n},!0),n(window,{$:s,$$:a},!0)}),define("i-canvas/0.0.1/lib/class",[],function(require,exports,module){var initializing=!1,fnTest=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(className,prop){prop||(prop=className,className="Anonymous");var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1;for(var name in prop)prototype[name]="function"==typeof prop[name]&&"function"==typeof _super[name]&&fnTest.test(prop[name])?function(t,e){return function(){var i=this._super;this._super=_super[t];var n=e.apply(this,arguments);return this._super=i,n}}(name,prop[name]):prop[name];var Class=eval("(function "+className+"() {    if ( !initializing && this.init )      this.init.apply(this, arguments);  })");return Class.prototype=prototype,Class.prototype.constructor=Class,Class.extend=arguments.callee,Class},module.exports=Class}),define("i-canvas/0.0.1/lib/util",["i-canvas/0.0.1/lib/class"],function(t,e,i){"use strict";var n=t("i-canvas/0.0.1/lib/class"),r=function(t,e){var i=t.length;switch(i){case 0:case 1:return t;case 2:return e(t[0],t[1])?[t[1],t[0]]:t;default:var n=Math.floor(i/2),o=n,s=i-n,a=r(t.slice(0,n),e),c=r(t.slice(n),e);t=[];for(var u=0,h=0;o-1>=u||s-1>=h;)t.push(u>o-1?c[h++]:h>s-1?a[u++]:e(a[u],c[h])?c[h++]:a[u++]);return t}},o=n.extend("EventEmitter",{on:function(t,e){t=t.toLowerCase();var i=this.__eventGetList__();return(i[t]=i[t]||[]).push(e),this},un:function(t,e){t=t.toLowerCase();var i=this.__eventGetList__(),n=i[t];if(n){e||(i[t]=null);for(var r=[],o=0,s=n.length;s>o;o++)n[o]!==e&&r.push(n[o]);i[t]=r.length?r:null}return this},fire:function(t,e){"[object Object]"===Object.prototype.toString.call(t)&&t.type&&!e&&(e=t,t=e.type),t=t.toLowerCase();var i=this.__eventGetList__(),n=i[t];if(n)for(var r=0,o=n.length;o>r;r++)try{n[r].call(this,e)}catch(s){console.warn(s)}return this},__eventGetList__:function(){return this.__eventList__||(this.__eventList__={}),this.__eventList__}});i.exports={stableSort:r,EventEmitter:o}});