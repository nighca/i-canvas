<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="https://rawgit.com/nighca/lib/master/lib.js"></script>
	<script type="text/javascript" src="../lib/class.js"></script>
	<script type="text/javascript" src="../index.js"></script>
	<style type="text/css">
	#canvas{
		width: 400px;
		height: 400px;
	}
	</style>
</head>
<body>

	<canvas id="canvas" width="400" height="400"></canvas>

	<script type="text/javascript">
	var canvas = $('#canvas');

	/*canvas.on('mouseenter', function(e){
		console.log(e);
	});

	canvas.on('mouseleave', function(e){
		console.log(e);
	});*/

	var icanvas = new Icanvas(canvas, '2d');

	var body = icanvas.document.body;

	var rec1 = body.createChild('rectangle', {
		top: 100,
		left: 100,
		width: 100,
		height: 100,
		background: 'yellow'
	});

	var circle1 = body.createChild('circle', {
		top: 300,
		left: 300,
		radius: 50,
		background: 'blue'
	});

	var circle2 = rec1.createChild('circle', {
		top: 50,
		left: 50,
		radius: 20,
		background: 'green',
		position: 'relative',
		'z-index': 10
	});

	circle1.on('click', function(e){
		body.createChild('circle', {
			top: Math.random() * 400,
			left: Math.random() * 400,
			radius: Math.random() * 20,
			background: 'white'
		});
	});

	/*body.on('click', function(e) {
		console.log('body cliked', e);
	})

	rec1.on('click', function(e) {
		console.log('rec cliked', e);
	})*/

    /*['click', 'drag', 'drop', 'mousedown', 'mousemove', 'mouseup'].forEach(function(eventName){
		circle1.on(eventName, function(e) {
			e.stopPropagation();
			console.log('circle', eventName, e);
		})
	});*/

	var movable = function(element){
		var offsetX = 0;
		var offsetY = 0;
		var win = $(window);

		var moveWith = function(e){
			element.setAttribute({
				left: e.x - offsetX,
				top: e.y - offsetY
			});
		};

		var endBind = function(e) {
			win.un('mousemove', moveWith);
			win.un('mouseup', endBind);
		};

		element.on('mousedown', function(e) {
			e.stopPropagation();

			offsetX = e.x - element.getAttribute('left');
			offsetY = e.y - element.getAttribute('top');

			win.on('mousemove', moveWith);
			win.on('mouseup', endBind);
		});
	};

	//movable(circle1);
	movable(circle2);
	movable(rec1);

	</script>

</body>
</html>